{% extends 'base.html' %}
{% block content %}
<h1 class="title">Definition {{ monitor.uuid }}{% if monitor.name %} – {{ monitor.name }}{% endif %}</h1>
<div class="columns">
    <div class="column is-two-thirds">
        <div class="box">
            <p><strong>Last status:</strong> {{ monitor.last_status or 'unknown' }}</p>
            <p><strong>Last checked:</strong> {{ monitor.last_checked or 'never' }}</p>
            <p><strong>Interval:</strong> {{ monitor.interval_seconds }} seconds</p>
            <div class="buttons">
                <form action="/monitor/{{ monitor.uuid }}/refresh" method="post">
                    <button class="button is-info" type="submit">Refresh now</button>
                </form>
                <form action="/monitor/{{ monitor.uuid }}/remove" method="post">
                    <button class="button is-danger" type="submit">Stop monitoring</button>
                </form>
            </div>
        </div>
        <div class="box">
            <h2 class="title is-5">Actions</h2>
            <div class="columns">
                <div class="column">
                    <form action="/process/{{ monitor.uuid }}/start" method="post">
                        <button class="button is-success" type="submit">Start</button>
                    </form>
                </div>
                <div class="column">
                    <form action="/process/{{ monitor.uuid }}/stop" method="post">
                        <div class="field">
                            <label class="label">Stop reason</label>
                            <div class="control">
                                <input class="input" type="text" name="reason" placeholder="Optional reason">
                            </div>
                        </div>
                        <button class="button is-warning" type="submit">Stop</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="box">
            <h2 class="title is-5">Recent Instances</h2>
            {% if monitor.recent_instances %}
            <div class="table-container">
                <table class="table is-fullwidth is-striped">
                    <thead>
                    <tr>
                        <th>Instance UUID</th>
                        <th>Status</th>
                        <th>Start (UTC)</th>
                        <th>End (UTC)</th>
                        <th>Author</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for instance in monitor.recent_instances %}
                        <tr>
                            <td>{{ instance.uuid }}</td>
                            <td>{{ instance.status or 'unknown' }}</td>
                            <td>{{ instance.start_date or '—' }}</td>
                            <td>{{ instance.end_date or '—' }}</td>
                            <td>{{ instance.author or '—' }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p>No instances returned for this definition yet.</p>
            {% endif %}
        </div>
    </div>
    <div class="column">
        <div class="box">
            <h2 class="title is-5">Configuration</h2>
            <p><strong>API base URL:</strong> {{ config.base_url or 'not set' }}</p>
        </div>
    </div>
</div>
{% endblock %}
